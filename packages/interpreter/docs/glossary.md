# 用語集

> Generated by Claude Opus 4.6

KSC インタプリタで使用される用語の定義。

## スクリプト関連

| 用語 | 定義 |
|---|---|
| **KSC** | Kaede Script の略。kaedevn ビジュアルノベルエンジン用のスクリプト言語 |
| **.ksc** | KSC スクリプトのファイル拡張子 |
| **KNF** | KNF Visual Novel Framework。kaedevn エンジンの内部フレームワーク名 |
| **セリフブロック** | `#キャラ名` で始まり `#` で終わるテキスト表示ブロック |
| **ラベル** | `*ラベル名` 形式で定義されるスクリプト内のジャンプ先 |
| **組み込みコマンド** | インタプリタに予め定義された関数（`bg`, `ch`, `bgm` 等） |
| **文字列補間** | セリフブロック内の `{式}` を評価結果で置換する機能 |

## アーキテクチャ

| 用語 | 定義 |
|---|---|
| **Interpreter** | スクリプトの実行を統括するメインクラス。Parser・Evaluator・GameState・IEngineAPI を協調させる |
| **Parser** | スクリプトテキストを行単位で分類し、構造（ラベル、セリフ、choice、関数定義）を検出する |
| **Tokenizer** | 式文字列をトークン列に分解する字句解析器 |
| **Evaluator** | トークン列を再帰下降パーサーで評価する式評価器。代入・条件評価・文字列補間も担当 |
| **GameState** | 変数ストア、コールスタック、ラベルマップ、関数定義テーブルを保持する状態管理クラス |
| **IEngineAPI** | プラットフォーム非依存のエンジン抽象インターフェース。描画・音声・UI 操作を定義 |
| **Debugger** | ブレークポイント、変数ウォッチ、ステップ実行、トレースログを提供するデバッグクラス |
| **ErrorHandler** | エラー種別の生成、Levenshtein 距離による修正候補提案、スタックトレースのフォーマットを行うユーティリティ |

## 型定義

| 用語 | 定義 |
|---|---|
| **LineType** | 行分類の列挙型。`DialogueStart`, `DialogueEnd`, `Label`, `Comment`, `Empty`, `Expression` |
| **TokenType** | トークン種別の列挙型。`Number`, `String`, `Boolean`, `Identifier`, `Operator`, `Assign`, `LeftParen`, `RightParen`, `LeftBrace`, `RightBrace`, `Comma`, `Keyword` |
| **Token** | `{ type: TokenType, value: string, position: number }` 形式のトークン |
| **CallFrame** | コールスタックのフレーム。`returnPc`, `scopeDepth`, `kind`（label/function/subroutine/method）, `source` を保持 |
| **FunctionDef** | 関数定義情報。`name`, `params`, `bodyStart`, `bodyEnd` を保持 |
| **ChoiceNode** | choice 構文の解析結果。`options` 配列と `end`（終了行）を保持 |
| **ChoiceOptionNode** | 個々の選択肢。`text`, `condition`（表示条件）, `bodyStart`, `bodyEnd` を保持 |
| **ChoiceOption** | IEngineAPI に渡す選択肢データ。`text` と任意の `condition` を保持 |
| **KNFError** | エラー情報の構造体。`type`, `message`, `line`, `stack`, `suggestions`, `context` を保持 |
| **ErrorType** | エラー種別の列挙型。`SyntaxError`, `ReferenceError`, `TypeError`, `RuntimeError`, `StackOverflow`, `FileNotFound` |

## 実行モデル

| 用語 | 定義 |
|---|---|
| **PC（プログラムカウンタ）** | 現在実行中の行番号（0 始まり） |
| **メインループ** | `while (running && pc < lines.length)` で 1 行ずつ `step()` を呼ぶ実行ループ |
| **コールスタック** | `call()`, `def`, `sub` の呼び出し履歴を管理するスタック |
| **ローカルスコープ** | 関数・サブルーチン呼び出し時に生成される変数スコープ（`Map<string, unknown>` のスタック） |
| **グローバルスコープ** | `GameState.variables` に格納されるトップレベルの変数空間 |
| **再帰深度上限** | 関数・サブルーチンの再帰呼び出しは最大 16 段まで |

## 関数の種類

| 用語 | 定義 |
|---|---|
| **def（関数）** | `def name(params) { ... }` で定義。`return expr` で値を返す。戻り値を変数に代入可能 |
| **sub（サブルーチン）** | `sub name(params) { ... }` で定義。値を返す `return` は禁止。副作用（セリフ表示等）専用 |
| **call/ret** | ラベルベースのサブルーチン呼び出し。`call("label")` でジャンプし、`ret()` で復帰する |

## プラットフォーム

| 用語 | 定義 |
|---|---|
| **Web 実装** | PixiJS/WebGL ベースの IEngineAPI 実装。`packages/web/` に配置 |
| **Switch 実装** | Nintendo Switch 向けの IEngineAPI 実装（将来） |
| **ConsoleEngine** | テスト・デモ用のコンソール出力 IEngineAPI 実装 |
| **MockEngine** | テスト用のモック IEngineAPI 実装。コマンドログを記録する |
