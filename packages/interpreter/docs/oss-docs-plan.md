# OSS インタプリタ ドキュメント整備計画

> Generated by Claude Opus 4.6

## 1. 背景

`@kaedevn/interpreter`（.ksc インタプリタ）の OSS 公開に向けて、`packages/interpreter/docs/` 直下に体系的なドキュメントを整備する。既存の日付別サブフォルダー（`2026/02/09/` 等）は monorepo からのコピーで変更しない。新規 md はすべて `docs/` 直下に配置する。

## 2. 作成ドキュメント一覧（24 ファイル）

### 要求仕様書（3 ファイル）

| # | ファイル名 | 内容 |
|---|---|---|
| 1 | `requirements-overview.md` | **要求仕様書（総合）** — プロジェクト目的、対象ユーザー、利用シーン、機能要件一覧、非機能要件（パフォーマンス・セキュリティ・移植性）、制約条件、用語集 |
| 2 | `requirements-scripting.md` | **スクリプト言語要求仕様書** — .ksc 言語に求められる機能（セリフ、変数、条件分岐、選択肢、関数、ラベル/ジャンプ）、各機能の優先度、受入基準 |
| 3 | `requirements-platform.md` | **プラットフォーム抽象化要求仕様書** — IEngineAPI に求められるメソッド一覧、各プラットフォーム（Web/Console/Switch）での期待動作、非同期制約、拡張ポイント |

### 仕様書（6 ファイル）

| # | ファイル名 | 内容 |
|---|---|---|
| 4 | `spec-ksc-language.md` | **KSC 言語仕様書** — .ksc の完全な文法定義（BNF/EBNF）、全構文要素（セリフブロック、ラベル、変数、if/else、choice、def/sub、コメント）、型システム（number/string/boolean/null）、演算子優先順位表、文字列補間ルール、予約語一覧 |
| 5 | `spec-builtin-commands.md` | **組み込みコマンド仕様書** — 17 個の組み込み関数の完全リファレンス。各コマンドの構文、引数、戻り値、同期/非同期、使用例、エラー時の挙動 |
| 6 | `spec-engine-api.md` | **IEngineAPI インターフェース仕様書** — 全 17+2 メソッドの型定義、引数・戻り値の詳細、async/sync の区別、呼び出しタイミング、実装時の注意事項、最小実装と完全実装の違い |
| 7 | `spec-expression.md` | **式評価仕様書** — Tokenizer のトークン種別一覧、Evaluator の演算子優先順位と結合性、型強制ルール（number+string 等）、関数呼び出し構文、エラー時の挙動、再帰呼び出しの上限（16段） |
| 8 | `spec-state-management.md` | **状態管理仕様書** — GameState の内部構造（変数ストア、コールスタック、ラベルマップ、関数定義テーブル）、スコープルール（グローバル/ローカル）、call/ret のスタック操作、getState() で取得可能な情報、セーブ/ロードとの関係 |
| 9 | `spec-error-handling.md` | **エラーハンドリング仕様書** — エラー種別（SyntaxError, ReferenceError, TypeError, RuntimeError, StackOverflow）、各エラーの発生条件とメッセージ形式、Levenshtein 距離による修正候補アルゴリズム、スタックトレースの構造、ErrorHandler の拡張ポイント |

### 設計書（5 ファイル）

| # | ファイル名 | 内容 |
|---|---|---|
| 10 | `design-architecture.md` | **アーキテクチャ設計書** — モジュール構成図、依存関係、実行パイプライン（テキスト → 行分類 → パース → 評価 → エンジン呼び出し）の詳細フロー、各クラスの責務分担、拡張ポイント |
| 11 | `design-parser.md` | **パーサー設計書** — Parser の行分類アルゴリズム、セリフブロック検出ロジック、ラベルインデックス構築（1パス目）、if/else/choice ブロックのネスト解析、関数/サブルーチン定義の検出 |
| 12 | `design-evaluator.md` | **式評価器設計書** — Tokenizer の状態遷移図、Evaluator の再帰下降パーサー構造、各優先度レベルのパースメソッド、関数呼び出し解決、文字列補間の処理フロー |
| 13 | `design-debug-system.md` | **デバッグシステム設計書** — Debugger クラスの設計、ブレークポイント管理、変数ウォッチ機構、ステップ実行（over/into/out）の制御フロー、デバッグイベントシステム、外部ツール連携インターフェース |
| 14 | `design-extensibility.md` | **拡張性設計書** — 新規コマンド追加の手順、IEngineAPI への新メソッド追加ガイド、カスタム組み込み関数の登録方法、プラグインアーキテクチャの将来設計 |

### 実装ガイド（3 ファイル）

| # | ファイル名 | 内容 |
|---|---|---|
| 15 | `guide-getting-started.md` | **はじめに（クイックスタート）** — インストール、最小の .ksc スクリプト作成、IEngineAPI 最小実装（ConsoleEngine）、実行手順、期待される出力、次のステップへの案内 |
| 16 | `guide-engine-implementation.md` | **IEngineAPI 実装ガイド** — コンソール実装の完全コード例、Web（PixiJS）実装のヒント、各メソッドの実装パターン（同期/非同期）、テスト方法、よくある実装ミスと対処法 |
| 17 | `guide-scripting.md` | **スクリプト記述ガイド** — .ksc の書き方チュートリアル。基本（セリフ+背景）→ 中級（変数+条件分岐+選択肢）→ 上級（関数+サブルーチン+文字列補間）の段階的解説。実践的なゲームシナリオの書き方 |

### テスト関連（3 ファイル）

| # | ファイル名 | 内容 |
|---|---|---|
| 18 | `testing-plan.md` | **テスト計画書** — テスト戦略（ユニット/統合/E2E）、テスト対象範囲、テスト環境、テストデータ、テストスケジュール、合格基準、既知の問題と対応方針 |
| 19 | `testing-procedure.md` | **テスト手順書** — 各テストファイルの実行方法、テストケース一覧（134+件）、フェーズ別テスト内容の詳細手順、期待結果、障害発生時の対処、回帰テストの実施方法 |
| 20 | `testing-coverage.md` | **テストカバレッジ報告書** — フェーズ別のカバレッジ状況、未カバー領域の特定（Phase5 再帰、大規模シナリオ）、カバレッジ向上計画、リスク分析 |

### 運用・リファレンス（4 ファイル）

| # | ファイル名 | 内容 |
|---|---|---|
| 21 | `api-reference.md` | **API リファレンス** — 全エクスポートクラス・関数・型の一覧。Interpreter, GameState, Parser, Tokenizer, Evaluator の公開メソッド・プロパティ。型定義（CallFrame, ChoiceNode, Token, LineType, FunctionDef 等） |
| 22 | `faq-troubleshooting.md` | **FAQ・トラブルシューティング** — よくある質問（Q&A 形式）、よくあるエラーと対処法、パフォーマンスの注意点、Phase5 再帰ハングの回避策、デバッグモードの活用方法 |
| 23 | `changelog.md` | **変更履歴** — Phase 1〜7 の実装履歴、各フェーズで追加された機能、破壊的変更、バグ修正の記録 |
| 24 | `glossary.md` | **用語集** — KSC, KNF, .ksc, IEngineAPI, GameState, CallFrame, Evaluator, Parser, Tokenizer 等のプロジェクト固有用語と一般用語の定義 |

## 3. 作成順序

```
Phase A: 基盤ドキュメント（最初に作成 — 他のドキュメントが参照する）
  1. glossary.md
  2. requirements-overview.md
  3. spec-ksc-language.md
  4. spec-engine-api.md

Phase B: コア仕様・設計（Phase A を参照して作成）
  5. requirements-scripting.md
  6. requirements-platform.md
  7. spec-builtin-commands.md
  8. spec-expression.md
  9. spec-state-management.md
  10. spec-error-handling.md
  11. design-architecture.md

Phase C: 詳細設計（Phase B を参照して作成）
  12. design-parser.md
  13. design-evaluator.md
  14. design-debug-system.md
  15. design-extensibility.md

Phase D: 実装ガイド・テスト（Phase A-C を参照して作成）
  16. guide-getting-started.md
  17. guide-engine-implementation.md
  18. guide-scripting.md
  19. testing-plan.md
  20. testing-procedure.md
  21. testing-coverage.md

Phase E: リファレンス・運用（最後に作成）
  22. api-reference.md
  23. faq-troubleshooting.md
  24. changelog.md
```

## 4. 共通フォーマット

全ドキュメントのヘッダー:

```markdown
# タイトル

> Generated by Claude Opus 4.6
```

## 5. 検証方法

- 全 24 ファイルが `packages/interpreter/docs/` 直下に存在すること
- `docs/README.md` に新規ファイルの索引を追加
- リンク切れがないこと

## 6. 実施結果

2026-02-24 に全 24 ファイルの作成を完了。

- 25 ファイル変更（24 新規 + README.md 更新）
- 合計 5,080 行追加
- 全ドキュメント間リンクの切れなし検証済み
- コミット: `7db78c5`
